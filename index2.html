<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>선 스펙트럼으로 원소 찾기 (미지 스펙트럼 정렬)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 15px 20px;
      max-width: 720px;
      margin: auto;
      font-size: 14px;
      line-height: 1.3;
    }
    h1 {
      font-size: 1.6em;
      margin-bottom: 10px;
    }
    .question {
      font-size: 1.1em;
      margin-bottom: 12px;
    }

    /* 공통 스펙트럼 스타일 */
    .spectrum {
      width: 320px;
      background: black;
      height: 28px;
      position: relative;
      border-radius: 3px;
      user-select: none;
      box-sizing: border-box;
      margin: 0;
    }

    /* 미지 스펙트럼 + 텍스트 flex 정렬 */
    .unknown-container {
      display: flex;
      align-items: center;
      margin: 6px 0 12px 0;
      font-weight: 600;
      font-size: 0.95em;
      gap: 9px;
    }
    .unknown-container strong {
      flex: 0 0 90px; /* 텍스트 고정폭 */
    }

    /* 보기 텍스트 + 스펙트럼 flex 배치 */
    #elementSpectra p {
      display: flex;
      align-items: center;
      margin: 6px 0 8px 0;
      font-weight: 600;
      font-size: 0.95em;
    }
    #elementSpectra p strong {
      flex: 0 0 90px;
    }
    #elementSpectra .spectrum {
      flex-shrink: 0;
      margin: 0;
    }

    /* 스펙트럼 선 스타일 */
    .line {
      position: absolute;
      width: 2.5px;
      height: 100%;
      border-radius: 1px;
    }

    form {
      margin-top: 10px;
      margin-bottom: 6px;
    }
    .element-list label {
      margin-right: 14px;
      cursor: pointer;
      font-size: 0.9em;
      user-select: none;
    }
    button {
      margin-left: 8px;
      font-size: 0.95em;
      padding: 5px 12px;
      cursor: pointer;
      border-radius: 4px;
      border: 1px solid #555;
      background: #f0f0f0;
      transition: background 0.2s ease;
    }
    button:hover {
      background: #ddd;
    }
    #result {
      min-height: 2em;
      margin-top: 12px;
      font-weight: 700;
    }
  </style>
</head>
<body>

  <h1>🌈 선 스펙트럼으로 원소 찾기 (미지 스펙트럼 정렬)</h1>

  <div class="question" id="questionText"></div>

  <h3>미지의 스펙트럼</h3>
  <div class="unknown-container">
    <strong>미지 스펙트럼</strong>
    <div class="spectrum" id="unknown"></div>
  </div>

  <h3>보기: 원소 스펙트럼</h3>
  <div id="elementSpectra"></div>

  <form id="answerForm">
    <fieldset class="element-list" id="answerOptions">
      <!-- 체크박스 동적 생성 -->
    </fieldset>
  </form>

  <button onclick="checkAnswer()">정답 확인</button>
  <button onclick="loadProblem()">다음 문제 ▶</button>

  <div id="result"></div>

<script>
  const WAVELENGTH_MIN = 400;
  const WAVELENGTH_MAX = 800;
  const SPECTRUM_WIDTH = 320; // px

  const elements = {
    H: { wl: [656, 486], name: "수소(H)" },
    He: { wl: [447, 501, 587], name: "헬륨(He)" },
    Na: { wl: [589], name: "나트륨(Na)" },
    O: { wl: [630, 636], name: "산소(O)" },
    K: { wl: [766, 770], name: "칼륨(K)" },
    Ca: { wl: [422, 443], name: "칼슘(Ca)" }
  };

  const problems = [
    { question: "수소와 헬륨이 혼합된 스펙트럼입니다. 포함된 원소를 모두 고르세요.", answer: ["H", "He"], unknown: [...elements.H.wl, ...elements.He.wl] },
    { question: "나트륨과 산소가 혼합된 스펙트럼입니다. 포함된 원소를 모두 고르세요.", answer: ["Na", "O"], unknown: [...elements.Na.wl, ...elements.O.wl] },
    { question: "칼륨과 칼슘이 포함된 스펙트럼입니다. 포함된 원소를 모두 고르세요.", answer: ["K", "Ca"], unknown: [...elements.K.wl, ...elements.Ca.wl] },
    { question: "수소, 나트륨, 칼슘 세 원소가 혼합된 스펙트럼입니다. 포함된 원소를 모두 고르세요.", answer: ["H", "Na", "Ca"], unknown: [...elements.H.wl, ...elements.Na.wl, ...elements.Ca.wl] },
    { question: "헬륨과 칼륨이 포함된 스펙트럼입니다. 포함된 원소를 모두 고르세요.", answer: ["He", "K"], unknown: [...elements.He.wl, ...elements.K.wl] },
    { question: "수소, 산소, 칼슘 세 원소가 혼합된 스펙트럼입니다. 포함된 원소를 모두 고르세요.", answer: ["H", "O", "Ca"], unknown: [...elements.H.wl, ...elements.O.wl, ...elements.Ca.wl] },
    { question: "나트륨, 칼륨, 산소가 포함된 스펙트럼입니다. 포함된 원소를 모두 고르세요.", answer: ["Na", "K", "O"], unknown: [...elements.Na.wl, ...elements.K.wl, ...elements.O.wl] },
    { question: "헬륨, 칼슘, 수소가 포함된 스펙트럼입니다. 포함된 원소를 모두 고르세요.", answer: ["He", "Ca", "H"], unknown: [...elements.He.wl, ...elements.Ca.wl, ...elements.H.wl] },
    { question: "수소, 헬륨, 나트륨, 산소가 혼합된 스펙트럼입니다. 포함된 원소를 모두 고르세요.", answer: ["H", "He", "Na", "O"], unknown: [...elements.H.wl, ...elements.He.wl, ...elements.Na.wl, ...elements.O.wl] },
    { question: "칼슘과 산소가 포함된 스펙트럼입니다. 포함된 원소를 모두 고르세요.", answer: ["Ca", "O"], unknown: [...elements.Ca.wl, ...elements.O.wl] },
    { question: "칼륨과 수소가 포함된 스펙트럼입니다. 포함된 원소를 모두 고르세요.", answer: ["K", "H"], unknown: [...elements.K.wl, ...elements.H.wl] },
    { question: "헬륨, 나트륨, 칼슘이 포함된 스펙트럼입니다. 포함된 원소를 모두 고르세요.", answer: ["He", "Na", "Ca"], unknown: [...elements.He.wl, ...elements.Na.wl, ...elements.Ca.wl] }
  ];

  let currentProblem;

  function wavelengthToPosition(wl) {
    if (wl < WAVELENGTH_MIN) wl = WAVELENGTH_MIN;
    if (wl > WAVELENGTH_MAX) wl = WAVELENGTH_MAX;
    const ratio = (wl - WAVELENGTH_MIN) / (WAVELENGTH_MAX - WAVELENGTH_MIN);
    return ratio * SPECTRUM_WIDTH;
  }

  function drawSpectrum(id, lines) {
    const container = document.getElementById(id);
    lines.forEach(wl => {
      const line = document.createElement("div");
      line.className = "line";
      line.style.background = `rgb(${wavelengthToRGB(wl).join(",")})`;
      line.style.left = `${wavelengthToPosition(wl)}px`;
      container.appendChild(line);
    });
  }

  function clearSpectrum(id) {
    document.getElementById(id).innerHTML = "";
  }

  function wavelengthToRGB(wl) {
    if (wl < 450) return [0, 0, 255];
    if (wl < 495) return [0, 255, 255];
    if (wl < 570) return [0, 255, 0];
    if (wl < 590) return [255, 255, 0];
    if (wl < 620) return [255, 165, 0];
    return [255, 0, 0];
  }

  function loadProblem() {
    clearSpectrum("unknown");
    clearSpectrum("elementSpectra");
    document.getElementById("result").innerText = "";

    currentProblem = problems[Math.floor(Math.random() * problems.length)];
    document.getElementById("questionText").innerText = `[문제] ${currentProblem.question}`;

    drawSpectrum("unknown", currentProblem.unknown);

    const elementSpectraDiv = document.getElementById("elementSpectra");
    const answerOptions = document.getElementById("answerOptions");
    answerOptions.innerHTML = "";

    Object.entries(elements).forEach(([key, el]) => {
      const p = document.createElement("p");
      p.innerHTML = `<strong>${el.name}</strong>`;
      const spectrumDiv = document.createElement("div");
      spectrumDiv.className = "spectrum";
      spectrumDiv.id = `spec_${key}`;
      p.appendChild(spectrumDiv);
      elementSpectraDiv.appendChild(p);

      drawSpectrum(spectrumDiv.id, el.wl);

      const label = document.createElement("label");
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.value = key;
      checkbox.name = "element";
      label.appendChild(checkbox);
      label.appendChild(document.createTextNode(el.name));
      answerOptions.appendChild(label);
    });
  }

  function checkAnswer() {
    const checkedEls = [...document.querySelectorAll('input[name="element"]:checked')].map(cb => cb.value);
    const correct = currentProblem.answer;
    const result = document.getElementById("result");

    const correctSet = new Set(correct);
    const checkedSet = new Set(checkedEls);

    const correctPicked = checkedEls.filter(x => correctSet.has(x));
    const missed = correct.filter(x => !checkedSet.has(x));
    const wrongPicked = checkedEls.filter(x => !correctSet.has(x));

    if (missed.length === 0 && wrongPicked.length === 0) {
      result.innerHTML = `✅ 정답입니다! 잘 맞추셨어요.<br>선택한 원소: ${correctPicked.map(x => elements[x].name).join(", ")}`;
      result.style.color = "green";
    } else {
      let msg = "❌ 오답입니다.<br>";
      if (missed.length > 0) msg += `➜ 누락된 원소: ${missed.map(x => elements[x].name).join(", ")}<br>`;
      if (wrongPicked.length > 0) msg += `➜ 틀리게 선택한 원소: ${wrongPicked.map(x => elements[x].name).join(", ")}`;
      result.innerHTML = msg;
      result.style.color = "red";
    }
  }

  window.onload = loadProblem;
</script>

</body>
</html>
